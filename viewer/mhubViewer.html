<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <script src="bower_components/canvasjs/canvasjs.min.js"></script>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
        }
        #graph {
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
    <div id="graph"></div>
    <script>

var dps = []; // dataPoints

var chart = new CanvasJS.Chart("graph",{
    // title :{
    //     text: "Live Tracking Data"
    // },
    axisX: {
        valueFormatString:  " "
    },
    axisY: {
        valueFormatString:  " ",
        gridThickness: 0
    },
    data: dps
});

var xVal = 0;
var yVal = 100;
var dataLength = 500; // number of dataPoints visible at any point

chart.render();

ws = new WebSocket('ws://localhost:13900');

//subscribe to receive messages
ws.onopen = function() {
    ws.send(JSON.stringify({
        type: 'subscribe',
        node: 'default'
    }));
};

//handle messages received
ws.onmessage = function(frame) {
    var msg = JSON.parse(frame.data);
    if (msg.topic === 'data') {
        msg.data.forEach((v, i) => {
            if (!dps[i]) {
                dps[i] = {
                    type:'line',
                    lineThickness: 1,
                    markerType: 'none',
                    dataPoints: []
                }
            }
            dps[i].dataPoints.push({
                x: xVal,
                y: v.value + (100*i)
            });
            if (dps[i].dataPoints.length > dataLength) {
                dps[i].dataPoints.shift();
            }
        });
        xVal += 1;
    }
};

function render() {
    chart.render();
    requestAnimationFrame(render);
}

render();

    </script>
</body>
</html>